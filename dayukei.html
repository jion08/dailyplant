<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>식물 관리</title>
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; max-width: 600px; margin: 20px auto; padding: 20px; }
        .plant-card { border: 1px solid #ddd; border-radius: 8px; padding: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        h1 { color: #4CAF50; text-align: center; }
        h2 { color: #4CAF50; margin-top: 0; }
        .water-info { font-weight: bold; color: #555; margin-top: 15px; }
        .water-button { background-color: #4CAF50; color: white; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; margin-top: 15px; }
    </style>
</head>
<body>
    <div id="plant-container">
        </div>

    <script>
        // 🚨여기에 Apps Script URL을 붙여넣으세요!
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxJr4RGPrtHJqPFqinJ8qvf7WzOWBmuyt4MJ5c1rhMidGv9iSocpHzMdJZkmQvPqpFC/exec';

        // URL에서 식물 ID를 추출하는 함수
        function getPlantIdFromUrl() {
            const filename = window.location.pathname.split('/').pop();
            return filename.split('.')[0];
        }

        // Google Sheets에서 식물 데이터를 가져와서 해당 식물만 표시하는 함수
        async function fetchPlantData() {
            const plantId = getPlantIdFromUrl();
            const container = document.getElementById('plant-container');
            
            if (!plantId) {
                container.innerHTML = '<h1 style="color:red;">식물 ID가 URL에 없습니다!</h1><p style="text-align:center;">예시: /dayukei.html</p>';
                return;
            }

            try {
                const response = await fetch(SCRIPT_URL);
                const allPlants = await response.json();
                
                const plant = allPlants.find(p => p.ID === plantId);
                
                if (plant) {
                    const rawDate = plant['마지막 물 준 날짜'];
                    let formattedDate = '기록 없음';

                    if (rawDate) {
                        const dateOnly = rawDate.slice(0, 10);
                        const parts = dateOnly.split('-'); // 예: ['2025', '08', '27']
                        formattedDate = `${parts[0]}년 ${parseInt(parts[1])}월 ${parseInt(parts[2])}일`;
                    }

                    container.innerHTML = `
                        <h2>${plant['식물 이름']}</h2>
                        <p>${plant['설명']}</p>
                        <div class="water-info">마지막 물 준 날짜: <span>${formattedDate}</span></div>
                        <button class="water-button" onclick="waterPlant('${plant['ID']}')">물 주기 완료</button>
                    `;
                } else {
                    container.innerHTML = '<h1>해당 식물 정보를 찾을 수 없습니다.</h1>';
                }

            } catch (error) {
                console.error('Error fetching plant data:', error);
                container.innerHTML = '<h1>식물 데이터를 불러오는 데 실패했습니다.</h1><p>Apps Script URL이 올바른지 확인해주세요.</p>';
            }
        }

        // 물 준 날짜를 Google Sheets에 업데이트하는 함수
        async function waterPlant(plantId) {
            const today = new Date().toISOString().slice(0, 10);
            const params = new URLSearchParams({ id: plantId, date: today });
            
            try {
                const response = await fetch(SCRIPT_URL + '?' + params.toString(), { method: 'POST' });
                const result = await response.json();

                if (result.success) {
                    alert('날짜가 성공적으로 업데이트되었습니다!');
                    fetchPlantData();
                } else {
                    alert('업데이트에 실패했습니다.');
                }
            } catch (error) {
                console.error('Error updating plant:', error);
                alert('업데이트 중 오류가 발생했습니다.');
            }
        }
        
        fetchPlantData();
    </script>
</body>
</html>
