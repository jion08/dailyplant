<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ì‹ë¬¼ ê´€ë¦¬</title>
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; max-width: 600px; margin: 20px auto; padding: 20px; }
        .plant-card { border: 1px solid #ddd; border-radius: 8px; padding: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        h1 { color: #4CAF50; text-align: center; }
        h2 { color: #4CAF50; margin-top: 0; }
        .water-info { font-weight: bold; color: #555; margin-top: 15px; }
        .water-button { background-color: #4CAF50; color: white; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; margin-top: 15px; }
    </style>
</head>
<body>
    <div id="plant-container">
        </div>

    <script>
        // ğŸš¨ì—¬ê¸°ì— Apps Script URLì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”!
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxJr4RGPrtHJqPFqinJ8qvf7WzOWBmuyt4MJ5c1rhMidGv9iSocpHzMdJZkmQvPqpFC/exec';

        // URLì—ì„œ ì‹ë¬¼ IDë¥¼ ì¶”ì¶œí•˜ëŠ” í•¨ìˆ˜
        function getPlantIdFromUrl() {
            const filename = window.location.pathname.split('/').pop();
            return filename.split('.')[0];
        }

        // Google Sheetsì—ì„œ ì‹ë¬¼ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì„œ í•´ë‹¹ ì‹ë¬¼ë§Œ í‘œì‹œí•˜ëŠ” í•¨ìˆ˜
        async function fetchPlantData() {
            const plantId = getPlantIdFromUrl();
            const container = document.getElementById('plant-container');
            
            if (!plantId) {
                container.innerHTML = '<h1 style="color:red;">ì‹ë¬¼ IDê°€ URLì— ì—†ìŠµë‹ˆë‹¤!</h1><p style="text-align:center;">ì˜ˆì‹œ: /dayukei.html</p>';
                return;
            }

            try {
                const response = await fetch(SCRIPT_URL);
                const allPlants = await response.json();
                
                const plant = allPlants.find(p => p.ID === plantId);
                
                if (plant) {
                    const rawDate = plant['ë§ˆì§€ë§‰ ë¬¼ ì¤€ ë‚ ì§œ'];
                    let formattedDate = 'ê¸°ë¡ ì—†ìŒ';

                    if (rawDate) {
                        const dateOnly = rawDate.slice(0, 10);
                        const parts = dateOnly.split('-'); // ì˜ˆ: ['2025', '08', '27']
                        formattedDate = `${parts[0]}ë…„ ${parseInt(parts[1])}ì›” ${parseInt(parts[2])}ì¼`;
                    }

                    container.innerHTML = `
                        <h2>${plant['ì‹ë¬¼ ì´ë¦„']}</h2>
                        <p>${plant['ì„¤ëª…']}</p>
                        <div class="water-info">ë§ˆì§€ë§‰ ë¬¼ ì¤€ ë‚ ì§œ: <span>${formattedDate}</span></div>
                        <button class="water-button" onclick="waterPlant('${plant['ID']}')">ë¬¼ ì£¼ê¸° ì™„ë£Œ</button>
                    `;
                } else {
                    container.innerHTML = '<h1>í•´ë‹¹ ì‹ë¬¼ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</h1>';
                }

            } catch (error) {
                console.error('Error fetching plant data:', error);
                container.innerHTML = '<h1>ì‹ë¬¼ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</h1><p>Apps Script URLì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.</p>';
            }
        }

        // ë¬¼ ì¤€ ë‚ ì§œë¥¼ Google Sheetsì— ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜
        async function waterPlant(plantId) {
            const today = new Date().toISOString().slice(0, 10);
            const params = new URLSearchParams({ id: plantId, date: today });
            
            try {
                const response = await fetch(SCRIPT_URL + '?' + params.toString(), { method: 'POST' });
                const result = await response.json();

                if (result.success) {
                    alert('ë‚ ì§œê°€ ì„±ê³µì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    fetchPlantData();
                } else {
                    alert('ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('Error updating plant:', error);
                alert('ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        fetchPlantData();
    </script>
</body>
</html>
